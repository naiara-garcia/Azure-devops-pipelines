name: nm-factory-inf-pip-operation-start-akstest

pool:
  name: Factory-VSS-Agents

variables:
- group: factory-azure-mgmt

#schedules:
#- cron: "30 7 * * *"
#  displayName: Starting the AKStest cluster
#  branches:
#    include:
#    - main
#  always: true

stage:
- stage: Stop_AKStest_cluster
  jobs:
  - job: stop_akstest_cluster

    steps:
    - task: AzureCLI@2
      displayName: "Start AKStest cluster" 
      env:
        ARM_CLIENT_ID: $(terraform-app-client-id)
        ARM_CLIENT_SECRET: $(terraform-app-secret)
        ARM_TENANT_ID: "9e296acd-1e44-44f0-8c77-cc9dbce85489"  #Must move to KeyValut or inside provider.tf
      inputs:
        azureSubscription: 'ecl-az-fact-svc-01-armconnection'
        scriptType: 'bash'
        scriptLocation: 'inlineScript'
        inlineScript: |
          #!/bin/bash
          echo "Login to Azure"
          echo $(mypat) | az login
          echo "Start AKStest Cluster"
          az aks start --name ecl-az-fact-cls-01-akstest --resource-group tes-te-test-tes-01-test --subscription azure-euroctl-hub-subs